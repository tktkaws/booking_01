# 現時点の仕様まとめ

本書は、2025-10-24 時点の UI/挙動の仕様をまとめたものです。実装差異があればこの文書を更新してください。

## レイアウト/レスポンシブ
- ビュー切替
  - md 以下: 強制的に `list` ビューのみ表示（`matchMedia('(max-width: 767.98px)')` で判定）。
  - md 以上: `month` / `week` / `list`（+ 管理者: `users`/`departments`）の切替ボタンを表示。
- ヘッダー行
  - md 未満: 縦並び（`flex flex-col`）。
  - md 以上: 横並びで左右に配置（`md:flex-row md:items-center md:justify-between`）。
- ビューラベル
  - `{viewLabel}` は lg 未満で非表示（`hidden lg:block`）。
- 「予約作成」ボタン
  - 現状: 固定幅 `w-20`、高さ `h-9`、テキスト「予約作成」。

## ListView（リスト表示）
- md 未満（モバイル）
  - 固定ヘッダーは廃止。
  - 各予約を「3行カード」で縦並び表示。
    - 1行目: 日付（開始〜終了）。
    - 2行目: 部署バッジ + 担当者名。
    - 3行目: タイトル（`line-clamp-2`）。
  - ビュー内の内部スクロールは無し（ページ全体でスクロール）。
- md 以上（デスクトップ）
  - テーブル風レイアウト（ヘッダー行あり）。
  - 内部スクロールあり（高さ上限: `max-h-[calc(100vh-260px)]`）。
  - 横方向のオーバーフロー時は横スクロール可（`overflow-x-auto`）。

## 予約作成モーダル（CreateBookingModal）
- サイズとスクロール
  - ダイアログ本体: `h-[80vh]`, `max-h-[90vh]`。
  - ヘッダー/フッター固定、本文のみ `overflow-y-auto`。
  - フッターは `sticky bottom-0` 固定。背景は `bg-white`。
- 日付入力
  - `type="date"` による単純な日付選択。
- 時間ピッカー（開始/終了）
  - UI: `button` を押すと選択肢パネルを開閉。
  - フォーカス: 開いた直後に最初の有効な選択肢へフォーカス移動。
  - 配置: 縦1列、`max-h-[200px] overflow-y-auto` でスクロール。
  - キーボード操作: Enter/Space で選択。現在選択中の項目を操作した場合もパネルを閉じる。
  - 候補一覧:
    - 開始候補: `TIME_SLOTS`（9:00〜18:00の15分刻み、18:00は開始候補から除外）。
    - 終了候補: 開始より後のスロットのみを表示（開始以下は非表示）。
  - 自動調整: 開始変更時は終了を +60 分相当の最短スロットへ自動更新（候補が無い場合は最善の近傍）。
- 重複チェック
  - フロントでリアルタイムに既存予約との重複を確認（開始/終了が更新されるたび）。
  - 送信時にも再チェックし、重複があればアラート表示で保存を中断。
- 入力項目
  - 件名（必須）、メモ（任意）、全社共有フラグ（チェックボックス）。
- そのほか
  - 保存成功後に `window.dispatchEvent(new CustomEvent('bookings:changed'))` を発火して一覧再読込を誘発。

## ベストプラクティス（時間選択の方針）
- 9:00〜18:00 を 15 分刻みでスロット化。
- 整合性: 常に `開始 < 終了`。UI で不整合候補は出さない（終了側は開始より後のみ表示）。
- UX: 現在時刻の「次の 15 分」＋1 時間を初期提案（実装側で調整可）。
- A11y: ラベル/フォーカス可視化/キーボード操作をサポート。カスタム UI は listbox 適合を検討。
- サーバー側: タイムゾーンを明示して `start < end` と重複を再検証。

## 既知の留意点/今後の調整候補
- 「予約作成」ボタンの幅は固定 `w-20`。文言の長短やロケールによりレイアウト崩れがある場合は `px-*` に戻す等の検討余地あり。
- モバイル ListView のカード情報量（例: 説明/ステータス追加）やアクセントの最適化は必要に応じて対応。
- キーボードで時間パネル内を矢印キー移動できるように拡張可能。

---
この仕様は `app/page.tsx`、`app/components/list/ListView.tsx`、`app/components/modal/CreateBookingModal.tsx` の実装に基づいています。
